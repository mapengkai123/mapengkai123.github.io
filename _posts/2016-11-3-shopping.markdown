---
layout: post
title:  "redis加入购物车!"
date:   2016-11-8 08:10:38 +0800
---
<img src="/images/fulls/08.jpg" class="fit image">


未登录下加入购物车，登录下合并购物车
在未登录状态下，没有指定的用户，此时购物车应该怎么分配，数据把偶才能在什么位置，这个其实也不难，我们可以将数据临时保存到Redis中，并不插入数据库中，因为此时没有对应的用户，Redis生成一个唯一的outerKey，保存到cookie中，每次添加商品，带上这个cookie，这样就保证每次加入同一个购物车，这个数据会被保存一段时间，当用户登录的时候，我们该如何将未登录状态下的购车和登录状态下的购车数据合并呢。这个就需要使用到消息了，我们可以发送一个消息给后台系统，将未登录状态下的outerKey传递给后台系统，后台系统到Redis中查询到未登录状态下的购物车，将购物车中的数据插入到数据库中，和之前登录状态下的购车数据合并，重新缓存到Redis中，此时缓存到Redis中的购物车是和未登录状态不同的，因为这个缓存的购物车是有主人的，未登录状态下缓存的临时购物车是没有主人的。